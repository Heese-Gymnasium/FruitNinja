<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Fruit Ninja HTML5 Canvas</title>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
        }

        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }

        /* All canvases receive input */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            display: block;
            width: 100vw;
            height: 100vh;
            z-index: 10;
            pointer-events: auto;
        }

        /* Background for bottom canvas */
        #bottom {
            background-image: url(assets/bg.jpg);
            background-size: cover;
            background-position: center;
        }

        /* GitHub icon */
        #fork {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 149px;
            height: 149px;
            cursor: pointer;
            z-index: 30;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        #fork:hover {
            transform: scale(1.1) rotate(10deg);
            opacity: 0.9;
        }

        /* FIXED → never blocks gameplay */
        #info {
            display: none !important;
            position: absolute;
            z-index: 0 !important;
            pointer-events: none !important;
            background: transparent !important;
            color: #fff;
            text-align: center;
            width: 70vw;
            max-width: 800px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        /* FIXED → never blocks gameplay */
        #loading {
            position: fixed;
            z-index: 5;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none !important;
        }

        #loading img {
            height: 64px;
            width: auto;
        }
    </style>

    <script src="js/libs/spp.min.js"></script>
    <script src="js/libs/preloadjs-0.3.0.min.js"></script>
    <script src="js/libs/soundjs-0.4.0.min.js"></script>
    <script src="js/libs/TweenLite.min.js"></script>
    <script src="js/libs/EasePack.min.js"></script>

    <script src="js/src/FruitGame.js"></script>
    <script src="js/src/Assets.js"></script>
    <script src="js/src/AssetsManager.js"></script>
    <script src="js/src/Collide.js"></script>
    <script src="js/src/Fruit.js"></script>
    <script src="js/src/Module_fruit.js"></script>
    <script src="js/src/Module_bomb.js"></script>
    <script src="js/src/Module_collide.js"></script>
    <script src="js/src/Module_blade.js"></script>
    <script src="js/src/Module_ui.js"></script>
    <script src="js/src/Main.js"></script>

    <script>
        /* RESIZE FIX */
        function resizeGame() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            ["bottom", "middle", "top"].forEach(id => {
                const canvas = document.getElementById(id);
                canvas.width = width;
                canvas.height = height;
            });

            FruitGame.scale = Math.max(width / 750, 0.5);
        }

        /* AUDIO RESUME FIX */
        function resumeAudioContext() {
            if (createjs.Sound.activePlugin && createjs.Sound.activePlugin.context) {
                const ctx = createjs.Sound.activePlugin.context;
                if (ctx.state === "suspended") ctx.resume();
            }
        }

        /* INIT */
        window.addEventListener("load", () => {
            resizeGame();

            /* Hide loading instantly when ready */
            setTimeout(() => {
                const loader = document.getElementById("loading");
                if (loader) loader.style.display = "none";
            }, 500);

            /* First click activates audio */
            const gesture = () => {
                resumeAudioContext();
                document.removeEventListener("mousedown", gesture);
                document.removeEventListener("touchstart", gesture);
            };

            document.addEventListener("mousedown", gesture);
            document.addEventListener("touchstart", gesture);
        });

        window.addEventListener("resize", resizeGame);
    </script>
</head>

<body>
<div id="game-container">
    <canvas id="bottom"></canvas>
    <canvas id="middle"></canvas>
    <canvas id="top"></canvas>

    <div id="loading">
        <img src="assets/loading.gif" alt="Loading">
    </div>

    <!-- Now 100% harmless -->
    <div id="info"></div>
</div>

<a id="fork" href="https://github.com/flashhawk" target="_blank"></a>
</body>
</html>
